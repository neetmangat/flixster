<script>
  $(function() {
    $('.lessons').sortable({
        update: function( event, ui ) {
        $.ajax({
          type: 'PUT',
          url: ui.item.data('update-url'),
          dataType: 'json',
          data: { lesson: { row_order_position: ui.item.index() } }
        });
      }
    });
  });
</script>

<br />
<div class="booyah-box col-10 offset-1">
    <h1 class="text-center"><%= current_course.title %></h1>
    <br />
    <%= image_tag current_course.image.url, class: 'img-fluid rounded mx-auto d-block imgdrop' %>
    <br />

    <div class="col-12 col-lg-8 offset-lg-2">
        <div class="row">
            <div class="col-md-4 col-12 text-center">
                <span class="badge badge-pill badge-default">
                    <% if current_course.free? %>
                        Free
                    <% else %>
                        <%= number_to_currency current_course.cost %>
                    <% end %>
                </span>
                <br />
                <br />
                <%= link_to 'Student View', course_path(current_course), class: 'btn btn-info' %>
            </div>

            <div class="col-md-8 col-12 description">
                <%= current_course.description %>
            </div>
        </div>
        <br />
        <hr />
        <br />
        <div class="text-center">
            <!--%= link_to 'Edit course', edit_instructor_course_path(current_course), class: 'btn btn-warning btn-lg' %-->
            <%= link_to 'Add a new section...', new_instructor_course_section_path(current_course), class: 'btn btn-warning btn-lg' %>
        </div>
    </div>

    <div class="col-12 col-lg-10 offset-lg-1">
        <% current_course.sections.each do |section| %>
            <br />

            <div class="section">
                <div class="row">
                    <h3 class="col-12 col-md-4 col-lg-6"><%= section.title %></h3>
                    <%= link_to 'Add a new lesson...', new_instructor_section_lesson_path(section), class: 'btn btn-warning col-8 offset-2 col-md-4 offset-md-3 col-lg-3 offset-lg-2'%>
                </div>
                
                <div class="row lessons">
                    <% section.lessons.rank(:row_order).each do |lesson| %>
                        <div class="col-12 col-md-6" data-update-url="<%= instructor_lesson_path(lesson) %>">
                            <div class="lesson text-center">
                                <%= link_to lesson_path(lesson) do %>
                                        <b><%= lesson.title %></b>
                                        <hr class="hr-white" />
                                        <%= lesson.subtitle %>
                                <% end %>
                            </div>
                        </div>
                    <% end %>
                </div>
            </div>
            <br class="clear" />
        <% end %>
    </div>
</div>

